<section class="page">

    <div class="loader" [hidden]="!loading">
        <span class="spinner" [hidden]="errorDisplay">Loading...</span><br>
        <p [hidden]="errorDisplay">Loading</p>

        <clr-alert [clrAlertClosable]="false" [hidden]="!errorDisplay" [clrAlertType]="'alert-danger'">
            <div clr-alert-item class="alert-item alert-danger">
                <span class="alert-text">
                    {{ errorMsg }}
                </span>
                <div class="alert-actions">
                    <clr-dropdown>
                        <button class="dropdown-toggle" clrDropdownTrigger>
                            Actions
                            <clr-icon shape="caret down"></clr-icon>
                        </button>
                        <clr-dropdown-menu clrPosition="bottom-right">
                            <a href="javascript://" class="dropdown-item" onclick="window.location.reload()" clrDropdownItem>Try again now</a>
                        </clr-dropdown-menu>
                    </clr-dropdown>
                </div>
            </div>
        </clr-alert>
    </div>

    <div class="overview" [hidden]="!overviewDisplay">
        <div class="hero-outer {{dashboardClass}}">
            <div class="hero">
                <h1>{{ dashboardStatus }}</h1>
                <p>{{ dashboardSub }}</p>
            </div>
        </div>

        <h1>Websites</h1>
        <div class="row feature-cards">
            <div class="col-lg-4 col-md-8 col-sm-12 col-xs-12" *ngFor="let item of reqData; let i = index" [attr.data-index]="i">
                <div class="card clickable {{item[0]['data']['us-status']}}" routerLink="/dashboard/{{item['id']}}">
                    <div class="card-header">
                        <h3 title="URL: {{ item['site'] }}"><input value="{{ item['name'] }}" readonly></h3>
                    </div>
                    <div class="card-block">
                        <!--<div class="card-title">-->
                        <!--</div>-->
                        <div class="card-text">
                            US Status: {{ item[0]["data"]["us-status"] }}; {{ item[0]["data"]["us-code"] }}<br> Uptime: Soon<br> Apdex: Soon<br> US Latency: {{ item[0]["data"]["us-ping"] }}ms<br> SSL Expiry: {{ sslTimes[i] }}
                        </div>
                    </div>
                    <div class="card-footer">
                        <button title="Check number" class="btn btn-sm btn-link">#{{ item[0]["data"]["id"] }}</button>
                        <button title="Time of last check" class="btn btn-sm btn-link">{{ localTimes[i] }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notfound" [hidden]="!notfoundDisplay">
        <div class="hero-outer">
            <div class="hero">
                <h1>404; not found</h1>
                <p>We didn&rsquo;t find &ldquo;{{ currentURL }}&rdquo; our servers. Sorry. Check if the URL you entered is correct and has no typos. If you know there is supposed to be something here, please email <a href="mailto:contact@useping.ga">contact@useping.ga</a></p>
                <div class="btn-group">
                    <button routerLink="/login/new" class="btn">Log in</button>
                    <button routerLink="/dashboard/overview" class="btn btn-primary">Dashboard &rarr;</button>
                </div>
            </div>
        </div>
    </div>

    <div class="more" [hidden]="!moreDisplay">
        <header class="header-7">
            <div class="branding">
                <a href="#" routerLink="/dashboard/overview" class="nav-link">
                    <clr-icon shape="arrow" size="18" dir="left" style="color: #fafafa"></clr-icon>
                    <span class="title">Back to Dashboard</span>
                </a>
            </div>
            <div class="header-actions">
            </div>
        </header>
        <div class="hero-outer {{ overviewStatus }}">
            <div class="hero">
                <h1>{{ moreName }}â€™s Analytics</h1>
                <p>{{ overviewSub }}</p>
            </div>
        </div>
        <div class="body">

            <div class="pc-tab">
                <input checked="checked" id="tab1" type="radio" name="pct">
                <input id="tab2" type="radio" name="pct">
                <input id="tab3" type="radio" name="pct">

                <nav>
                    <ul>
                        <label for="tab1">
                            <li class="tab1">Overview</li>
                        </label>
                        <label for="tab2">
                            <li class="tab2">Outages</li>
                        </label>
                        <label for="tab3">
                            <li class="tab3">Logs</li>
                        </label>
                    </ul>
                </nav>
                
                <section>
                    <div class="tab1">
                        <h2>Overview</h2>
                        <div [hidden]="!latencyLineChartJS">
                            <canvas id="latencyLineChart">{{ latencyLineChartJS }}</canvas>
                        </div>
                        <div [hidden]="!lookupLineChartJS">
                            <canvas id="lookupLineChart">{{ lookupLineChartJS }}</canvas>
                        </div>
                        <h3>United States</h3>
                        <div class="row feature-cards" *ngFor="let item of reqMoreDataForOverview">
                            <div class="col-lg-3 col-md-8 col-sm-12 col-xs-12">
                                <div class="card">
                                    <div class="card-block">
                                        <div class="card-title">
                                            <h3>{{ item["us-status"] }}</h3>
                                        </div>
                                        <div class="card-text">
                                            Status
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-8 col-sm-12 col-xs-12">
                                <div class="card">
                                    <div class="card-block">
                                        <div class="card-title">
                                            <h3>{{ item["us-data"] }} bytes</h3>
                                        </div>
                                        <div class="card-text">
                                            Data Downloaded
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-8 col-sm-12 col-xs-12">
                                <div class="card">
                                    <div class="card-block">
                                        <div class="card-title">
                                            <h3>{{ item['us-ssl-authority'] }}</h3>
                                        </div>
                                        <div class="card-text">
                                            SSL Authority
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-8 col-sm-12 col-xs-12">
                                <div class="card">
                                    <div class="card-block">
                                        <div class="card-title">
                                            <h3>{{ item['us-ssl-expiry'] }}</h3>
                                        </div>
                                        <div class="card-text">
                                            SSL Expiry Date
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab2">
                        <h2>Outages</h2>
                        <clr-datagrid>
                            <clr-dg-placeholder>We&rsquo;re sorting the data.</clr-dg-placeholder>
                            <clr-dg-column>Time</clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn>Code (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn>Status (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn>Latency (US / EU / IN)</ng-container>
                            </clr-dg-column>
    
                            <clr-dg-row *clrDgItems="let item of outages">
                                <clr-dg-cell>{{timesForLog[item]}}</clr-dg-cell>
                                <clr-dg-cell>{{reqMoreData[item][0]["us-code"]}} / {{reqMoreData[item][0]["uk-code"]}} / {{reqMoreData[item][0]["in-code"]}}</clr-dg-cell>
                                <clr-dg-cell>{{reqMoreData[item][0]["us-status"]}} / {{reqMoreData[item][0]["uk-status"]}} / {{reqMoreData[item][0]["in-status"]}}</clr-dg-cell>
                                <clr-dg-cell>{{reqMoreData[item][0]["us-ping"]}}ms / {{reqMoreData[item][0]["uk-ping"]}}ms / {{reqMoreData[item][0]["in-ping"]}}ms</clr-dg-cell>
                            </clr-dg-row>
    
                            <clr-dg-footer>
                                <clr-dg-column-toggle>
                                    <clr-dg-column-toggle-title>Columns to show:</clr-dg-column-toggle-title>
                                    <clr-dg-column-toggle-button clrType="selectAll">Select All</clr-dg-column-toggle-button>
                                    <clr-dg-column-toggle-button clrType="ok">
                                        <clr-icon shape="check"></clr-icon>
                                    </clr-dg-column-toggle-button>
                                </clr-dg-column-toggle>
                                <clr-dg-pagination #pagination2 [clrDgPageSize]="10">
                                    {{pagination2.firstItem + 1}} - {{pagination2.lastItem + 1}} of {{pagination2.totalItems}} outages in {{pagination.totalItems}} checks
                                </clr-dg-pagination>
                            </clr-dg-footer>
                        </clr-datagrid>
                    </div>
                    <div class="tab3">
                        <h2>Logs</h2>
                        <clr-datagrid>
                            <clr-dg-placeholder>We&rsquo;re sorting the data.</clr-dg-placeholder>
                            <clr-dg-column>Time</clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn>Code (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn>Status (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn>Latency (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn="{hidden: true}">Nameserver Lookup (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn="{hidden: true}">SSL Authority (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn="{hidden: true}">SSL Expiry (US / EU / IN)</ng-container>
                            </clr-dg-column>
                            
                            <clr-dg-column>
                                <ng-container *clrDgHideableColumn="{hidden: true}">Data Downloaded (US / EU / IN)</ng-container>
                            </clr-dg-column>
    
                            <clr-dg-row *clrDgItems="let item of reqMoreData; let i = index" [attr.data-index]="i">
                                <clr-dg-cell>{{timesForLog[i]}}</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-code"]}} / {{item[0]["uk-code"]}} / {{item[0]["in-code"]}}</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-status"]}} / {{item[0]["uk-status"]}} / {{item[0]["in-status"]}}</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-ping"]}}ms / {{item[0]["uk-ping"]}}ms / {{item[0]["in-ping"]}}ms</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-lookup"]}}ms / {{item[0]["uk-lookup"]}}ms / {{item[0]["in-lookup"]}}ms</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-ssl-authority"]}} / {{item[0]["uk-ssl-authority"]}} / {{item[0]["in-ssl-authority"]}}</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-ssl-expiry"]}} / {{item[0]["uk-ssl-expiry"]}} / {{item[0]["in-ssl-expiry"]}}</clr-dg-cell>
                                <clr-dg-cell>{{item[0]["us-data"]}} / {{item[0]["uk-data"]}} / {{item[0]["in-data"]}}</clr-dg-cell>
                            </clr-dg-row>
    
                            <clr-dg-footer>
                                <clr-dg-column-toggle>
                                    <clr-dg-column-toggle-title>Columns to show:</clr-dg-column-toggle-title>
                                    <clr-dg-column-toggle-button clrType="selectAll">Select All</clr-dg-column-toggle-button>
                                    <clr-dg-column-toggle-button clrType="ok">
                                        <clr-icon shape="check"></clr-icon>
                                    </clr-dg-column-toggle-button>
                                </clr-dg-column-toggle>
                                <clr-dg-pagination #pagination [clrDgPageSize]="10">
                                    {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} checks
                                </clr-dg-pagination>
                            </clr-dg-footer>
                        </clr-datagrid>
                    </div>
                </section>
            </div>
        </div>
    </div>
    
    <div class="add" [hidden]="!addDisplay">
        <div class="login-wrapper">
            <form [formGroup]="addWebsite" (ngSubmit)="addWebsiteToDB(addWebsite.value)" class="login">
                <label class="title">
                    Add new websites
                </label>
                <div class="login-group">
                    <div class="form-group">
                        <p>URL</p>
                        <label for="url"
                                aria-haspopup="true"
                                role="tooltip"
                                class="tooltip tooltip-validation tooltip-sm"
                                [class.invalid]="addWebsite.get('url').invalid
                                    && (addWebsite.get('url').dirty ||
                                    addWebsite.get('url').touched)">
                            <input id="url" spellcheck="false" type="url" placeholder="https://usehype.ga/" formControlName="url">
                            <span class="tooltip-content">
                                The field is empty or the URL is invalid.
                            </span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <p>Timeout</p>
                        <label for="timeout"
                                aria-haspopup="true"
                                role="tooltip"
                                class="tooltip tooltip-validation tooltip-sm"
                                [class.invalid]="addWebsite.get('timeout').invalid
                                    && (addWebsite.get('timeout').dirty ||
                                    addWebsite.get('timeout').touched)">
                            <input id="timeout" type="number" placeholder="1000ms = 1s" formControlName="timeout">
                            <span class="tooltip-content">
                                Timeout is required.
                            </span>
                        </label>
                    </div>
                    
                    <div class="error {{errorDisplayAdd}}">
                        {{ errorMsgAdd }}
                    </div>
                    
                    <button type="submit" [disabled]="addWebsite.invalid" class="btn btn-primary">{{ addWebsiteStatus }}</button>
                </div>
            </form>
        </div>
    </div>
</section>
